{{ $pages := .Site.RegularPages }}
{{ $blogPages := where $pages "Section" "blog" }}
{{ $bookPages := where $pages "Section" "books" }}

{
  "version": "1.0",
  "pages": [
    {{- $index := 0 -}}
    {{- range $blogPages -}}
    {{- if $index }},{{ end -}}
    {
      "title": {{ .Title | jsonify }},
      "url": {{ .RelPermalink | jsonify }},
      "content": {{ .Plain | truncate 500 | jsonify }},
      "date": {{ .Date.Format "2006-01-02" | jsonify }},
      "section": "blog",
      "categories": {{ .Params.categories | jsonify }},
      "tags": {{ .Params.tags | jsonify }}
    }
    {{- $index = add $index 1 -}}
    {{- end -}}
    {{- range $bookPages -}}
    {{- if $index }},{{ end -}}
    {
      "title": {{ .Title | jsonify }},
      "url": {{ .RelPermalink | jsonify }},
      "content": {{ .Plain | truncate 500 | jsonify }},
      "section": "books",
      "genre": {{ .Params.genre | jsonify }}
    }
    {{- $index = add $index 1 -}}
    {{- end -}}
  ]
}
